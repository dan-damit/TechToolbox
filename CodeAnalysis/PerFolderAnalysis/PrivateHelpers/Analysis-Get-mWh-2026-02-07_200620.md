# Code Analysis Report
Generated: 2/7/2026 8:06:20 PM

## Summary
 This PowerShell function, `Get-mWh`, is designed to parse a string input representing an energy value in either mWh (megaWatt hours) or Wh (watt hours), and returns the integer value of the parsed energy. Here are some suggestions for improving its functionality, readability, and performance:

1. Use constants for units: Instead of hardcoding unit names like 'mwh' and 'wh', define constant variables at the beginning of your script to improve readability and maintainability.

```powershell
$UNIT_MWH = "mWh"
$UNIT_WATT_HOURS = "Wh"
```

2. Use TryParse instead of regular expressions: Using regular expressions can slow down the script's performance, especially for large input strings. Instead, you can use PowerShell's built-in `TryParse` function to parse numbers more efficiently:

```powershell
$num = [double]::NaN
if ($text -match '^\d+(\.\d+)?$') {
    if ([Double]::TryParse($text, [System.Globalization.NumberStyles]::Any, $null, [ref]$num)) {
        # Proceed with the function logic
    } else {
        return $null
    }
} else {
    return $null
}
```

3. Handle cases when the input string is empty or null: Currently, the function will throw an error if the input string is null or empty. You can add a check for this and return an appropriate message instead.

4. Improve error handling: Instead of returning `$null`, you can use PowerShell's built-in error-handling mechanisms to provide more informative error messages when encountering invalid inputs.

5. Validate the unit: Currently, the script does not check if the specified unit is valid. It is a good practice to validate user input and return an appropriate error message if an invalid unit is provided.

6. Use consistent naming conventions: In your current code, some variable names are camelCase (e.g., `num`) while others are PascalCase (e.g., `Text`). It is recommended to follow a consistent naming convention throughout the script for better readability and maintainability.

7. Use comments and documentation: Though your original code was well-structured, adding comments and documentation can make it easier for others to understand the purpose of different parts of the script.

## Source Code
```powershell
function Get-mWh {
    [CmdletBinding()]
    param(
        [Parameter(Mandatory)]
        [string]$Text
    )

    $clean = Update-Text $Text

    # Capture number + optional unit
    $match = [regex]::Match($clean, '(?i)\b([0-9][0-9,\.]*)\s*(mwh|wh)?\b')
    if (-not $match.Success) { return $null }

    $num = $match.Groups[1].Value -replace ',', ''
    $unit = $match.Groups[2].Value.ToLower()

    if ($num -notmatch '^\d+(\.\d+)?$') {
        return $null
    }

    $val = [double]$num

    switch ($unit) {
        'mwh' { return [int][math]::Round($val) }
        'wh' { return [int][math]::Round($val * 1000) }
        default {
            # No unit â€” infer based on magnitude
            if ($val -ge 1000) {
                return [int][math]::Round($val)      # assume mWh
            }
            else {
                return [int][math]::Round($val * 1000) # assume Wh
            }
        }
    }
}
[SIGNATURE BLOCK REMOVED]

```
